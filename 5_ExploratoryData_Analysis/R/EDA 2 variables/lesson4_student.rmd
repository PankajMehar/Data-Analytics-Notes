Lesson 4 : Explore Two variables 
========================================================

***
```{r}
#pf <- read.csv("pseudo_facebook.tsv", sep = '\t')

pf <- read.delim("pseudo_facebook.tsv", stringsAsFactors = FALSE)
names(pf)
```

```{r}
head(pf)
```

```{r}
str(pf)
```

```{r}
pf$gender <- factor(pf$gender)
head(pf)
```


### Loading libraries

```{r}
suppressMessages(library(dplyr))
library(ggplot2)
library(tidyr)
```

***

### Scatterplots
Notes:

```{r Scatterplots}
# Using qplot 
# qplot(x = age, y = friend_count, data = pf)

# qplot can also be used for scatterplot without labelling x and y but just using position
# qplot(age, friend_count, data = pf)

# Using ggplot

ggplot(data = pf, aes(x = age, y = friend_count)) +
  geom_point()
  
```

***

#### What are some things that you notice right away?
Response: __ I noticed __ that at some age groups of around 20, 70 and 100 the friend counts of people are very high.

__Udacity  __ : Besides that some accountsmay be fake due to ridiculous higher counts.

***

### ggplot Syntax
Notes: 

Finding out the upper and lower limit of age using the summary() command.
```{r}
summary(pf$age)
```

__ In ggplot always add moifications as layers as this helps in debugging errors.__

Adding a layer to the ggplot code above to limit the x-axis from 13 to 90. 
As facebook users must have a minimum age of 13 and assume people above age of 90 given is false data.
```{r ggplot Syntax}
ggplot(data = pf, aes(x = age, y = friend_count)) +
  geom_point() +
  xlim(13,90)

```

***

### Overplotting
Notes:

Overplotting makes it difficult to tell how many points are in each region. (Like in the graph these points are stacked one over the other).

We can __set the transparency of the points using the alpha parameter __ in geom_points().

__(alpha = 1/20)__  --> This makesit will take 20 points to be equivalent to one of these dark dot.
That is 20 transparent points are required to make the dots dark.

__Alpha transparency for overlapping elements expressed as a fraction between 0 (complete transparency) and 1 (complete opacity).__


```{r Overplotting}
ggplot(data = pf, aes(x = age, y = friend_count)) +
  geom_point(alpha = 1/20) +
  xlim(13,90)

```

Running the above code we see that bulk of our data lies between 1000.

We can also __add jitter__. In the code __swap geom_point() and geom_jitter().__

Age is a continuous variable and we have only integer values and we see above that the columns above are perfectly lined up columns which isn't a true reflection of age (so its initutively wrong). We need to see more of points.
Using jitter we add some noise to each age so that we get a clear pic of relationship between age and friend_count.

```{r}
ggplot(data = pf, aes(x = age, y = friend_count)) +
  geom_jitter(alpha = 1/20) +
  xlim(13,90)
```

Running our code with jitter we get a more dispersed distribution.

#### What do you notice in the plot?
Response:

Friend_count for young users are nearly as high as they look before. Bulk of young users have friend_count below 1000

***

### Coord_trans()

[Look up the documentation for coord_trans()](http://docs.ggplot2.org/current/coord_trans.html)

'coord_trans' is different to scale transformations in that it occurs after statistical transformation and will affect the visual appearance of geoms - there is no guarantee that straight lines will continue to be straight.

Transformations only work with continuous values.

x, y  -- transformers for x and y axes

limx, limy	-- limits for x and y axes. (Named so for backward compatibility)

Also refer : [geom_smooth()](http://ggplot2.tidyverse.org/reference/geom_smooth.html)

Add a __layer__ to the plot that transforms friend_count using the square_root function.

Also switch back to __geom_point()__ from __geom_jitter()__. 
As it is showing error when used with geom_jitter().
If we wanted to add  __geom_jitter()__ to the code we had to put more elaborate syntaxes to specify that we only wanted to jitter the ages. We have to be careful because if we add jitter to friend_count hten those people having zero(0) friend_count may have negative value for the friend_count.

And these may lead to square root resulting in imaginary values *i*. So to make this adjustment we pass the position parameter as 'position = position_jitter(h = 0)' where h is the minimum height. Hence it prevents us from getting the warnings and -ve error counts. 

__Remember jitter can add +ve or -ve noise to each of our points.__ 

#### Look up the documentation for coord_trans() and add a layer to the plot that transforms friend_count using the square root function. Create your plot!

```{r Coord_trans()}
ggplot(data = pf, aes(x = age, y = friend_count)) +
  geom_point(alpha = 1/20, position = position_jitter(h = 0)) +
  xlim(13,90)+
  coord_trans(y = 'sqrt')

```

Here we see distribution of friend_count conditional on age. For exaple we can see thresholds of friend_count above which there are many few users.

***

### Alpha and Jitter
Examine the relationship between friendships_initiated (y) and age (x) using the ggplot syntax. We recommend creating a basic scatter
plot first to see what the distribution looks like and then adjusting it by adding one layer at a time.

Remember to make adjustments to the breaks of the x-axis and to use apply alpha and jitter.


```{r Alpha and Jitter}

ggplot(data = pf, aes(x = age, y = friendships_initiated)) +
  geom_point(alpha = 1/20, size = 1.5, position = position_jitter(h = 0))+
  xlim(13,90) +
  coord_trans(y = 'sqrt')

```


## Using coord_trans('log10')
When I tried to submit the same graph using log10 in the coord_trans function, I got an error. My submission
looked like this:
```

ggplot(aes(x = age, y = friendships_initiated), data = pf) + geom_point(alpha = 1/20, position = position_jitter(h = 1)) +
  xlim(13,90) +
  coord_trans(y = "log10")
```
 log10 would throw an error if it was 0. some 'friendships_initiated' are zero.
 So used 'y = friendships_initiated + 0.001' ta avoid error using 'log 0'.
 
 
```{r}
ggplot(data = pf, aes(x = age, y = friendships_initiated + 0.001)) +
  geom_point(alpha = 1/20, size = 1.5, position = position_jitter(h = 0))+
  xlim(13,90) +
  coord_trans(y = 'log10')
```


```{r}
ggplot(aes(x = age, y = friendships_initiated+0.01), data = pf) +
geom_point(alpha = 1/20, position = position_jitter(h=0)) +
coord_trans(y = "log10") + 
scale_x_continuous(breaks = seq(0,max(pf$age),10))+
  scale_y_continuous(breaks = seq(0,10,1))
```


If you add breaks to the 'y' axis, you will see why there are bars of data in certain locations: This is because there is no jitter in the y direction and the values are integers.

***

### Conditional Means
Notes:

__dplyr__ - package that helps to transform tidy, tabular data:
Most common functions are:
- filter()
- groupby()
- mutate()
- arrange()

```{r Conditional Means}

age_groups <- group_by(pf,age)
pf.fc_by_age <- summarise(age_groups,
                          friend_count_mean = mean(friend_count),
                          friend_count_median = median(friend_count),
                          n = n()
                          )
pf.fc_by_age <- arrange(pf.fc_by_age, age)
head(pf.fc_by_age)

```

### Conditional means alternate code using %%

```{r}
pf.fc_by_age2 <- pf %>%
  group_by(age) %>%
  summarise(friend_count_mean2 = mean(friend_count),
            friend_count_median2 = median(friend_count),
            n = n()) %>%
  arrange(age)

head(pf.fc_by_age2)
```



Create your plot!

```{r Conditional Means Plot}
ggplot(data = pf.fc_by_age2, aes(x = age, y = friend_count_mean2)) +
  geom_point()+
  geom_line()
```

***

### Overlaying Summaries with Raw Data
Notes: Ggplot allows us to easily create various summaries of our data and plot them. This could be
especially useful for quick exploration and for combining plots of raw data, like our original scatter
plot with displaying summaries.

This plot is one of those displaying summaries and I want to be able
to display it over the original plot we had for friend_count versus age. 

Let's see that first original scatter plot again. Now since all these points are black, I'm going to change the color of these. So that way when I overlay the summary, it's easier to see. 

I'm going to make the color here orange. So now, I've got my scatter plot and I want to overlay the summary that we have from before. I want to put this on top of this. I can add a geom_line to our plot to do so. Here I'm __going to pass the parameter stat and set it equal to summary__, and I'm going to __give it a function for y__. 

__The fun.y parameter takes any type of function, so that way we can apply it to the y values__. In this case, I want to take the mean. 

And there it is, this is my summary line for the mean friend count by age, over my raw data or my scatter plot.


```{r Overlaying Summaries with Raw Data}
ggplot(data = pf, aes(x = age, y = friend_count)) +
  geom_point(alpha = 1/20, position = position_jitter(h = 0), color = 'orange') +
  coord_cartesian(xlim = c(13,90))+
  coord_trans(y = 'sqrt')+
  geom_line(stat = 'summary', fun.y = mean) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.9), color = 'blue', linetype = 2 ) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.2), color = 'blue', linetype = 'dotdash' ) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.5), color = 'blue', linetype = 'solid' )
  
```

- geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.9), color = 'blue', linetype = 2 ) : 90% of users lie below this point.
- geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.9), color = 'blue', linetype = 2 ) : This ddenotes the median

#### What are some of your observations of the plot?
Response: Having more than 1000 users is very rare even for very young users.

To use coord_cartesian() layer need to remove the __xlim__ layer and the __coord_trans(y = 'sqrt')__ layer.
I need to obseve users between age of 13 and 70 and for friend_count 90th percentile is 1000 so taking ylim as c(0,1000).


```{r}
ggplot(data = pf, aes(x = age, y = friend_count)) +
  geom_point(alpha = 1/20, position = position_jitter(h = 0), color = 'orange') +
  coord_cartesian(xlim = c(13,70), ylim = c(0,1000) )+
  geom_line(stat = 'summary', fun.y = mean) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.9), color = 'blue', linetype = 2 ) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.2), color = 'blue', linetype = 'dotdash' ) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = 0.5), color = 'blue', linetype = 'solid' )
```

From 35 to 60 year old front count falls below 250. So 90% of people in this age group have friends below 250.

***


### Correlation
Notes:

```{r Correlation}
cor(pf$age, pf$friend_count)
```

Look up the documentation for the cor.test function.

```{r}
cor.test(pf$age, pf$friend_count, method = 'pearson')
```



***

### Correlation on Subsets
Notes:

```{r Correlation on Subsets}
with( pf, cor.test(age, friend_count, method = 'pearson'))
```

***

### Correlation Methods
Notes:

***

## Create Scatterplots
Notes:

```{r}

```

***

### Strong Correlations
Notes:

```{r Strong Correlations}

```

What's the correlation betwen the two variables? Include the top 5% of values for the variable in the calculation and round to 3 decimal places.

```{r Correlation Calcuation}

```

Response:

***

### Moira on Correlation
Notes:

***

### More Caution with Correlation
Notes:

```{r More Caution With Correlation}
install.packages('alr3')
library(alr3)
```

Create your plot!

```{r Temp vs Month}

```

***

### Noisy Scatterplots
a. Take a guess for the correlation coefficient for the scatterplot.

b. What is the actual correlation of the two variables?
(Round to the thousandths place)

```{r Noisy Scatterplots}

```

***

### Making Sense of Data
Notes:

```{r Making Sense of Data}

```

***

### A New Perspective

What do you notice?
Response:

Watch the solution video and check out the Instructor Notes!
Notes:

***

### Understanding Noise: Age to Age Months
Notes:

```{r Understanding Noise: Age to Age Months}

```

***

### Age with Months Means

```{r Age with Months Means}

```

Programming Assignment
```{r Programming Assignment}

```

***

### Noise in Conditional Means

```{r Noise in Conditional Means}

```

***

### Smoothing Conditional Means
Notes:

```{r Smoothing Conditional Means}

```

***

### Which Plot to Choose?
Notes:

***

### Analyzing Two Variables
Reflection:

***

Click **KnitHTML** to see all of your hard work and to have an html
page of this lesson, your answers, and your notes!

